# 接口契约模板（用于重写 1:1 兼容）

> 每个“对外接口”都要有一份契约文档，契约是验收标准；实现细节可以变，但契约不能变。

## 1. 基本信息

- 接口名称：
- 所属应用：`api` / `admin` / `seller` / `travel` / `window` / `selfservice` / `xc` / `meituan` / `index` / `mobile` / `handheld`
- 线上路径（必须保持一致）：
  - `GET/POST/...`：
  - 是否存在 `.html` 后缀调用（必须兼容）：是/否
- 业务描述（一句话）：
- 影响范围：小程序 / 管理后台 / 第三方回调 / 其它

## 2. 鉴权与安全

- 鉴权方式：
  - Token Header（如 `Token` + `Userid/Uuid/No`）
  - Session Cookie（如 `PHPSESSID`）
  - 签名/加密（携程 AES+md5、美团 BA 等）
- 必要 Header（大小写是否敏感要写清）：
- 失败错误码与返回体（保持一致）：
- 速率限制/风控（如有）：

## 3. 请求

- HTTP Method：
- Path：
- Query 参数：
  - `name`：类型，是否必填，约束，示例
- Body：
  - Content-Type：
  - 字段列表（类型/必填/约束/示例）
- 文件上传（如有）：multipart 字段名、大小/后缀限制、返回结构
- 幂等键（如有）：来源/规则/有效期

## 4. 响应

- HTTP 状态码（是否固定 200）：
- 返回 Content-Type：
- 返回结构：
  - JSON 包裹（例如 `code/msg/time/data`）或第三方约定结构（例如 `xc.header` / `meituan.code`）
- 字段说明（类型/含义/可为空/示例）
- 错误码表（至少列出：鉴权失败、参数错误、业务失败、系统异常）

## 5. 副作用与一致性要求（重写最容易出事故）

- 数据写入：
  - 写哪些表/哪些字段（概念级即可，不要写敏感信息）
  - 事务边界：是否要求原子性
- 外部调用：短信、OSS、支付、OTA 等
- 幂等策略：重放请求/回调多次的处理
- 并发策略：库存扣减、核销、退款等的并发控制

## 6. 性能与可观测性

- 目标耗时（P95/P99）：
- 日志：关键字段、脱敏策略
- 指标：成功率、错误码分布、外部调用耗时
- 追踪：traceId 传递（如有）

## 7. 测试用例（验收清单）

- 契约测试（golden）：输入 -> 期望输出（包含字段顺序/类型/空值形态）
- 异常用例：缺 Header、token 过期、签名错误、参数越界、重复回调等
- 回归用例：与关键链路组合测试（如下单 -> 支付 -> 回调 -> 发券 -> 核销）

