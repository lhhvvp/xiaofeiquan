// 回车触发登录
$(document).keyup(function (event) {
    if (event.keyCode == 13) {
        $(".login").trigger("click");
    }
});
$(function () {
    // 刷新验证码操作
    $(".layadmin-user-login-codeimg").click(function () {
        $(this).attr("src", $(this).attr("src") + '?' + Math.random());
    })
    // 后台登录
    $(".login").click(function () {
        var username = $("input[name='username']").val();
        var password = $("input[name='password']").val();
        var __token__ = $("input[name='__token__']").val();
        var vercode = $("input[name='vercode']").val();
        if (!username) {
            layer.alert('请输入用户名', {
                icon: 2
            }, function (index) {
                layer.close(index);
                $("input[name='username']").focus();
            });
            return false;
        }
        if (!password) {
            layer.alert('请输入密码', {
                icon: 2
            }, function (index) {
                layer.close(index);
                $("input[name='password']").focus();
            });
            return false;
        }
        $.ajax({
            type: "post",
            url: "/admin/login/checkLogin",
            data: {
                username: username,
                password: password,
                vercode: vercode,
                __token__: __token__
            },
            dataType: "json",
            beforeSend: function () {
                loadIndex = layer.load();
            },
            success: function (data) {
                if (data.error == 1) {
                    layer.close(loadIndex);
                    layer.alert(data.msg, {
                        icon: 2
                    }, function (index) {
                        layer.close(index);
                        $(".layadmin-user-login-codeimg").attr("src", $(".layadmin-user-login-codeimg").attr("src") + '?' + Math.random());
                        $("input[name='vercode']").val('').focus();
                    });
                } else if (data.error == 2) {
                    layer.close(loadIndex);
                    layer.alert(data.msg, {
                        icon: 2
                    }, function (index) {
                        layer.close(index);
                        window.location.reload();
                    });
                } else {
                    window.location.href = data.href;
                }
            },
            error: function (xhr) {

            }
        });

    })
})