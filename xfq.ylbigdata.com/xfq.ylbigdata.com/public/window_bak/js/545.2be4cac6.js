"use strict";(self["webpackChunkticket"]=self["webpackChunkticket"]||[]).push([[545],{4338:function(e,t,a){a.r(t),a.d(t,{default:function(){return g}});var l=a(3396),n=a(4870),i=a(9242),r=a(5351),o=a(7178),s=a(65);const c={class:"main backdrop-filter"},u={class:"table-box"},d={style:{padding:"0 20px 0"}};var p={__name:"index",setup(e){const t=(0,n.iH)(null),a=(0,s.oR)(),p=(0,n.iH)(""),v=(0,n.iH)([{label:"",type:"selection",width:60},{label:"序号",type:"index",width:60,align:"center"},{label:"门票名称",prop:"ticket_title",width:240,align:"center"},{label:"订单号",prop:"trade_no",width:240,align:"center"},{label:"姓名",prop:"tourist_fullname",align:"center"},{label:"身份证",prop:"tourist_cert_id",align:"center"},{label:"金额(元)",prop:"ticket_price",align:"center"},{label:"购买时间",prop:"create_time",align:"center"},{label:"有效期",prop:"ticket_date",align:"center"},{label:"操作",fixed:"right",width:180,align:"center",tdSlot:"operate"}]),f=async e=>{p.value=e.order;let t=[];return"order"===e.order_status?await g(e).then((e=>{t=e.data})):await m(e).then((e=>{e&&(t=e.data)})),{data:t,total:0}};async function g(){let e={order_sn:p.value};return await a.dispatch("orderListSearch",e)}async function m(){let e={idcard:p.value};return await a.dispatch("orderListIdcard",e)}const w=(0,n.iH)("");function h(e=!1,t){let a=null;if(e){if(""===w.value)return(0,o.z8)({message:"请选择数据",type:"warning",showClose:!0,duration:3e3}),!1;console.log(w),a=w.value}else a=t.ticket_code;k(a)}function k(e){let l={codes:e};a.dispatch("takeTickets",l).then((e=>{0===e.code?((0,o.z8)({message:e.msg||"success",type:"success",showClose:!0,duration:3e3}),t.value.refresh()):(0,o.z8)({message:e.msg||"error",type:"warning",showClose:!0,duration:3e3})}))}function _(e){if(e){let t=e.map((e=>e.ticket_code));t=t.join(","),w.value=t}}const b=(0,n.iH)(!1),y=(0,n.iH)(null),C=(0,n.iH)(!1);function H(){let e=y.value.readyState;1===e&&(C.value=!0),3===e&&(C.value=!1)}function z(){if(C.value)S();else{var e="ws:127.0.0.1:7415";y.value=new WebSocket(e),y.value.onopen=()=>H(),y.value.onmessage=e=>{if("failed to obtain ID card information"!=e.data){b.value=!1;var t=e.data.split("|");t.length>=17?p.value=t[6]:(0,o.z8)({message:e.data,type:"warning"})}}}}function S(){y.value.close()}function x(){if(C.value){let t=1e4;t="timeout="+t;var e=t;let a="03?"+e;y.value.send(a),b.value=!0}else(0,o.z8)({message:"未连接服务",type:"warning"})}return(0,l.bv)((()=>{z()})),(e,a)=>{const o=(0,l.up)("el-button"),s=(0,l.Q2)("loading");return(0,l.wg)(),(0,l.iD)("div",c,[(0,l._)("div",u,[(0,l.Wm)((0,n.SU)(r.Z),{columns:v.value,request:f,ref_key:"proTable",ref:t,stripe:"",border:"",hideTitleBar:!0,onSelectionChange:_,pagination:!1,search:{fields:[{type:"select",label:"类型",name:"order_status",options:[{value:"order",name:"订单号"},{value:"idCard",name:"身份证号"}]},{type:"input",label:"编号/身份证",name:"order"}]}},{operate:(0,l.w5)((e=>[(0,l.Wm)(o,{size:"mini",type:"primary",onClick:(0,i.iM)((t=>h(!1,e.row)),["prevent"])},{default:(0,l.w5)((()=>[(0,l.Uk)("打印门票")])),_:2},1032,["onClick"])])),_:1},8,["columns"]),(0,l._)("div",d,[(0,l.wy)(((0,l.wg)(),(0,l.j4)(o,{type:"primary",onClick:x},{default:(0,l.w5)((()=>[(0,l.Uk)("识别身份证 ")])),_:1})),[[s,b.value,void 0,{fullscreen:!0,lock:!0}]]),(0,l.Wm)(o,{type:"primary",onClick:a[0]||(a[0]=e=>h(!0,{}))},{default:(0,l.w5)((()=>[(0,l.Uk)("打印选中门票")])),_:1})])])])}}},v=a(89);const f=(0,v.Z)(p,[["__scopeId","data-v-201f5c63"]]);var g=f}}]);
//# sourceMappingURL=545.2be4cac6.js.map