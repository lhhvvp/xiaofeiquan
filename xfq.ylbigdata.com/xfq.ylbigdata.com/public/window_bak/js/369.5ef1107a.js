"use strict";(self["webpackChunkticket"]=self["webpackChunkticket"]||[]).push([[369],{1818:function(e,t,a){a.r(t),a.d(t,{default:function(){return g}});var n=a(3396),l=a(4870),i=a(9242),r=a(5351),o=a(7178),s=a(65);const c={class:"main"},u={class:"table-box"},d={style:{padding:"0 20px 0"}};var p={__name:"index",setup(e){const t=(0,l.iH)(null),a=(0,s.oR)(),p=(0,l.iH)(""),v=(0,l.iH)([{label:"",type:"selection",width:60},{label:"序号",type:"index",width:60,align:"center"},{label:"门票名称",prop:"ticket_title",width:240,align:"center"},{label:"订单号",prop:"trade_no",width:240,align:"center"},{label:"姓名",prop:"tourist_fullname",align:"center"},{label:"身份证",prop:"tourist_cert_id",align:"center"},{label:"金额(元)",prop:"ticket_price",align:"center"},{label:"购买时间",prop:"create_time",align:"center"},{label:"有效期",prop:"ticket_date",align:"center"},{label:"操作",fixed:"right",width:180,align:"center",tdSlot:"operate"}]),f=async e=>{p.value=e.order;let t=[];return"order"===e.order_status?await g(e).then((e=>{t=e.data})):await m(e).then((e=>{e&&(t=e.data)})),{data:t,total:0}};async function g(){let e={order_sn:p.value};return await a.dispatch("orderListSearch",e)}async function m(){let e={idcard:p.value};return await a.dispatch("orderListIdcard",e)}const w=(0,l.iH)("");function h(e=!1,t){let a=null;if(e){if(""===w.value)return(0,o.z8)({message:"请选择数据",type:"warning",showClose:!0,duration:3e3}),!1;console.log(w),a=w.value}else a=t.ticket_code;_(a)}function _(e){let n={codes:e};a.dispatch("takeTickets",n).then((e=>{0===e.code?((0,o.z8)({message:e.msg||"success",type:"success",showClose:!0,duration:3e3}),t.value.refresh()):(0,o.z8)({message:e.msg||"error",type:"warning",showClose:!0,duration:3e3})}))}function k(e){if(e){let t=e.map((e=>e.ticket_code));t=t.join(","),w.value=t}}const y=(0,l.iH)(!1),b=(0,l.iH)(null),C=(0,l.iH)(!1);function H(){let e=b.value.readyState;1===e&&(C.value=!0),3===e&&(C.value=!1)}function S(){if(C.value)z();else{var e="ws:127.0.0.1:7415";b.value=new WebSocket(e),b.value.onopen=()=>H(),b.value.onmessage=e=>{if("failed to obtain ID card information"!=e.data){y.value=!1;var t=e.data.split("|");t.length>=17?p.value=t[6]:(0,o.z8)({message:e.data,type:"warning"})}else document.querySelector("#message").innerHTML+=`<p>接收数据: ${e.data}</p>`}}}function z(){b.value.close()}function x(){if(C.value){let t=1e4;t="timeout="+t;var e=t;let a="03?"+e;b.value.send(a),y.value=!0}else(0,o.z8)({message:"未连接服务",type:"warning"})}return(0,n.bv)((()=>{S()})),(e,a)=>{const o=(0,n.up)("el-button"),s=(0,n.Q2)("loading");return(0,n.wg)(),(0,n.iD)("div",c,[(0,n._)("div",u,[(0,n.Wm)((0,l.SU)(r.Z),{columns:v.value,request:f,ref_key:"proTable",ref:t,stripe:"",border:"",hideTitleBar:!0,onSelectionChange:k,pagination:!1,search:{fields:[{type:"select",label:"类型",name:"order_status",options:[{value:"order",name:"订单号"},{value:"idCard",name:"身份证号"}]},{type:"input",label:"编号/身份证",name:"order"}]}},{operate:(0,n.w5)((e=>[(0,n.Wm)(o,{size:"mini",type:"primary",onClick:(0,i.iM)((t=>h(!1,e.row)),["prevent"])},{default:(0,n.w5)((()=>[(0,n.Uk)("打印门票")])),_:2},1032,["onClick"])])),_:1},8,["columns"]),(0,n._)("div",d,[(0,n.wy)(((0,n.wg)(),(0,n.j4)(o,{type:"primary",onClick:x},{default:(0,n.w5)((()=>[(0,n.Uk)("识别身份证 ")])),_:1})),[[s,y.value,void 0,{fullscreen:!0,lock:!0}]]),(0,n.Wm)(o,{type:"primary",onClick:a[0]||(a[0]=e=>h(!0,{}))},{default:(0,n.w5)((()=>[(0,n.Uk)("打印选中门票")])),_:1})])])])}}},v=a(89);const f=(0,v.Z)(p,[["__scopeId","data-v-3f049654"]]);var g=f}}]);
//# sourceMappingURL=369.5ef1107a.js.map