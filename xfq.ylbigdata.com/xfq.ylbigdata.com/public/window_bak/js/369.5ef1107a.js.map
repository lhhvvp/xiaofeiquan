{"version":3,"file":"js/369.5ef1107a.js","mappings":"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","sources":["webpack://ticket/./src/views/ticket/index.vue","webpack://ticket/./src/views/ticket/index.vue?079f"],"sourcesContent":["<template>\r\n    <div class=\"main\">\r\n      <div class=\"table-box\">\r\n\r\n        <vue3-pro-table :columns=\"columns\" :request=\"getList\" ref=\"proTable\" stripe border :hideTitleBar=\"true\"\r\n                        @selection-change=\"selection\" :pagination=\"false\" :search=\"{fields:[\r\n\r\n          {type:'select',label:'类型',name:'order_status' ,options:[{\r\n            value:'order',\r\n            name:'订单号'\r\n          },{\r\n            value:'idCard',\r\n            name:'身份证号'\r\n          }]},\r\n          {type:'input',label:'编号/身份证',name:'order'},\r\n      ]}\">\r\n          <template #operate=\"scope\">\r\n            <el-button size=\"mini\" type=\"primary\" @click.prevent=\"submit(false,scope.row)\">打印门票</el-button>\r\n          </template>\r\n        </vue3-pro-table>\r\n        <div style=\"padding: 0 20px 0\">\r\n          <el-button type=\"primary\" @click=\"ReadIDCard\"\r\n                     v-loading.fullscreen.lock=\"fullscreenLoading\">识别身份证\r\n          </el-button>\r\n          <el-button type=\"primary\" @click=\"submit(true,{})\">打印选中门票</el-button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n</template>\r\n\r\n<script setup>\r\nimport Vue3ProTable from \"vue3-pro-table\"\r\nconst proTable = ref(null) //vue 缓存,\r\nimport {onMounted, ref} from \"vue\";\r\nimport {ElMessage} from \"element-plus\";\r\nimport {useStore} from \"vuex\";\r\n\r\nconst store = useStore() //vue 缓存,\r\nconst keyWord = ref('')\r\n\r\nconst columns = ref([\r\n  {label: \"\", type: \"selection\", width: 60},\r\n  {label: \"序号\", type: \"index\", width: 60, align: \"center\"},\r\n  {label: \"门票名称\", prop: \"ticket_title\", width: 240, align: \"center\"},\r\n  {label: \"订单号\", prop: \"trade_no\", width: 240, align: \"center\"},\r\n  {label: \"姓名\", prop: \"tourist_fullname\", align: \"center\"},\r\n  {label: \"身份证\", prop: \"tourist_cert_id\", align: \"center\"},\r\n  {label: \"金额(元)\", prop: \"ticket_price\", align: \"center\"},\r\n  {label: \"购买时间\", prop: \"create_time\", align: \"center\"},\r\n  {label: \"有效期\", prop: \"ticket_date\", align: \"center\"},\r\n  {\r\n    label: \"操作\",\r\n    fixed: \"right\",\r\n    width: 180,\r\n    align: \"center\",\r\n    tdSlot: \"operate\", // 自定义单元格内容的插槽名称\r\n  },\r\n]);\r\n\r\nconst getList = async (data) => {\r\n  keyWord.value = data.order;\r\n  let val = [];\r\n  if (data.order_status === 'order') {\r\n    await orderAjax(data).then(res => {\r\n      val = res.data;\r\n    });\r\n  } else {\r\n    await idcardAjax(data).then(res => {\r\n      if (res) {\r\n        val = res.data;\r\n      }\r\n    });\r\n  }\r\n  return {\r\n    data: val,\r\n    total: 0,\r\n  }\r\n}\r\n\r\nasync function orderAjax() {\r\n  let option = {\r\n    order_sn: keyWord.value,\r\n  };\r\n  return await store.dispatch('orderListSearch', option);\r\n}\r\n\r\nasync function idcardAjax() {\r\n  let option = {\r\n    idcard: keyWord.value,\r\n  };\r\n  return await store.dispatch('orderListIdcard', option);\r\n}\r\n\r\n\r\nconst selectionVal = ref('');\r\n\r\nfunction submit(all = false, val) {\r\n  let id = null;\r\n  if (all) {\r\n    //多选\r\n    if (selectionVal.value === '') {\r\n      ElMessage({\r\n        message: '请选择数据' || 'error', type: 'warning', showClose: true, duration: 3 * 1000\r\n      });\r\n      return false;\r\n    }\r\n    ;\r\n    console.log(selectionVal);\r\n    id = selectionVal.value;\r\n  } else {\r\n    //单选\r\n    id = val.ticket_code;\r\n  }\r\n  ajax(id);\r\n}\r\n\r\nfunction ajax(id) {\r\n  let option = {\r\n    codes: id\r\n  }\r\n  store.dispatch('takeTickets', option).then(res => {\r\n    if (res.code === 0) {\r\n      ElMessage({\r\n        message: res.msg || 'success', type: 'success', showClose: true, duration: 3 * 1000\r\n      });\r\n      proTable.value.refresh();\r\n    }else {\r\n      ElMessage({\r\n        message: res.msg || 'error', type: 'warning', showClose: true, duration: 3 * 1000\r\n      });\r\n    }\r\n  });\r\n}\r\n\r\nfunction selection(e) {\r\n  if (e) {\r\n    let ids = e.map(item => {\r\n      return item.ticket_code;\r\n    });\r\n    ids = ids.join(\",\");\r\n    selectionVal.value = ids;\r\n  }\r\n}\r\n\r\n// 识别身份证\r\nconst fullscreenLoading = ref(false);\r\nconst websockets = ref(null), isconncet = ref(false);\r\n\r\nfunction socketChange() {\r\n  let state = websockets.value.readyState;\r\n  //读身份证\r\n  if (1 === state) {\r\n    isconncet.value = true;\r\n  }\r\n  if (3 === state) {\r\n    isconncet.value = false;\r\n  }\r\n}\r\n\r\nfunction OcrRecognition() {\r\n  if (!isconncet.value) {\r\n    // 1. 创建websockets对象，参数为服务器websockets地址\r\n    var url = \"ws:127.0.0.1:7415\"\r\n    websockets.value = new WebSocket(url);\r\n    websockets.value.onopen = () => socketChange();\r\n    //监听接收消息的情况\r\n    websockets.value.onmessage = (res) => {\r\n      if (res.data == \"failed to obtain ID card information\") {\r\n        document.querySelector(\"#message\").innerHTML += `<p>接收数据: ${res.data}</p>`\r\n        return;\r\n      }\r\n      fullscreenLoading.value = false;\r\n      var alldata = res.data.split(\"|\");\r\n      if (alldata.length >= 17) {\r\n        keyWord.value = alldata[6];\r\n      } else {\r\n        ElMessage({\r\n          message: res.data,\r\n          type: 'warning',\r\n        })\r\n      }\r\n    }\r\n    //监听关闭时的状态变化\r\n  } else {\r\n    closeConnect();\r\n  }\r\n}\r\n\r\n/**\r\n *   关闭连接\r\n *\r\n */\r\nfunction closeConnect() {\r\n  websockets.value.close();\r\n}\r\n\r\nfunction ReadIDCard() {\r\n\r\n  if (!isconncet.value) {\r\n    ElMessage({\r\n      message: '未连接服务',\r\n      type: 'warning',\r\n    })\r\n  } else {\r\n    let paramTimeOut = 10000;\r\n    paramTimeOut = \"timeout=\" + paramTimeOut;\r\n    var parameterAll = paramTimeOut;\r\n    let val = \"03?\" + parameterAll;\r\n    websockets.value.send(val);\r\n    fullscreenLoading.value = true;\r\n  }\r\n}\r\n\r\n\r\nonMounted(() => {\r\n  OcrRecognition();\r\n});\r\n\r\n</script>\r\n<style>\r\nbody {\r\n\r\n}\r\n</style>\r\n\r\n<style scoped>\r\n.main {\r\n  background-color: #ffffff;\r\n  width: 100%;\r\n  height: 100%;\r\n}\r\n\r\n.table-box {\r\n  position: relative;\r\n  border: 1px solid #409eff50;\r\n  border-radius: 10px;\r\n  width: calc(100% - 42px);\r\n  height: calc(100% - 2px);\r\n  padding: 0 20px;\r\n}\r\n\r\n\r\n</style>","import script from \"./index.vue?vue&type=script&setup=true&lang=js\"\nexport * from \"./index.vue?vue&type=script&setup=true&lang=js\"\n\nimport \"./index.vue?vue&type=style&index=0&id=3f049654&lang=css\"\nimport \"./index.vue?vue&type=style&index=1&id=3f049654&scoped=true&lang=css\"\n\nimport exportComponent from \"../../../node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-3f049654\"]])\n\nexport default __exports__"],"names":["proTable","ref","store","useStore","keyWord","columns","label","type","width","align","prop","fixed","tdSlot","getList","async","value","data","order","val","order_status","orderAjax","then","res","idcardAjax","total","option","order_sn","dispatch","idcard","selectionVal","submit","all","id","ElMessage","message","showClose","duration","console","log","ticket_code","ajax","codes","code","msg","refresh","selection","e","ids","map","item","join","fullscreenLoading","websockets","isconncet","socketChange","state","readyState","OcrRecognition","closeConnect","url","WebSocket","onopen","onmessage","alldata","split","length","document","querySelector","innerHTML","close","ReadIDCard","paramTimeOut","parameterAll","send","onMounted","__exports__"],"sourceRoot":""}