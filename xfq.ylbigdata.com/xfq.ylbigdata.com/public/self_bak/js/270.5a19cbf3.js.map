{"version":3,"file":"js/270.5a19cbf3.js","mappings":"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","sources":["webpack://ticket/./src/views/order/index.vue","webpack://ticket/./src/views/order/index.vue?cbbd"],"sourcesContent":["<template>\r\n  <div style=\"height: 100vh;\">\r\n    <div class=\"back\">\r\n      <el-icon>\r\n        <ArrowLeftBold/>\r\n      </el-icon>\r\n      <text style=\"margin-left: 10px\" @click=\"navtoback()\">返回首页</text>\r\n    </div>\r\n    <div class=\"main-idCard\" v-if=\"is_idCard\">\r\n      <div class=\"idCard-text\">*请将身份证放到感应器上点击识别按钮</div>\r\n      <div class=\"idCard\">\r\n        <div class=\"idCard-bg\"><img src=\"../../assets/bg2.gif\"/></div>\r\n      </div>\r\n      <el-button class=\"idCard-button\" type=\"primary\" @click=\"ReadIDCard\"\r\n                 v-loading.fullscreen.lock=\"fullscreenLoading\">点击识别\r\n      </el-button>\r\n    </div>\r\n    <div class=\"main\" v-if=\"!is_idCard\">\r\n      <div class=\"table-box\">\r\n\r\n        <vue3-pro-table :columns=\"columns\" :request=\"getList\" ref=\"proTable\" stripe border :hideTitleBar=\"true\"\r\n                        @selection-change=\"selection\" :pagination=\"false\" :search=\"{fields:[\r\n          {type:'select',label:'类型',name:'order_status' ,options:[{\r\n            value:'order',\r\n            name:'订单号'\r\n          },{\r\n            value:'idCard',\r\n            name:'身份证号'\r\n          }]},\r\n          {type:'input',label:'编号/身份证',name:'order'},\r\n      ]}\">\r\n          <template #operate=\"scope\">\r\n            <el-button size=\"mini\" type=\"primary\" @click.prevent=\"submit(false,scope.row)\">打印门票</el-button>\r\n          </template>\r\n        </vue3-pro-table>\r\n        <div style=\"padding: 0 20px 0\">\r\n          <el-button type=\"primary\" @click=\"ReadIDCard\"\r\n                     v-loading.fullscreen.lock=\"fullscreenLoading\">识别身份证\r\n          </el-button>\r\n          <el-button type=\"primary\" @click=\"submit(true,{})\">打印选中门票</el-button>\r\n        </div>\r\n      </div>\r\n\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\nimport Vue3ProTable from \"vue3-pro-table\"\r\nimport router from \"@/router\";\r\nimport {onMounted, ref} from \"vue\";\r\nimport {ElMessage} from \"element-plus\";\r\nimport {useStore} from \"vuex\";\r\n\r\nconst is_idCard = ref(true);\r\n\r\nconst store = useStore() //vue 缓存,\r\nconst proTable = ref(null) //vue 缓存,\r\nconst keyWord = ref('')\r\n\r\nfunction navtoback() {\r\n  router.push({path: '/main'});\r\n}\r\n\r\nconst columns = ref([\r\n  {label: \"\", type: \"selection\", width: 60},\r\n  {label: \"序号\", type: \"index\", width: 60, align: \"center\"},\r\n  {label: \"门票名称\", prop: \"ticket_title\", width: 240, align: \"center\"},\r\n  {label: \"订单号\", prop: \"trade_no\", width: 240, align: \"center\"},\r\n  {label: \"姓名\", prop: \"tourist_fullname\", align: \"center\"},\r\n  {label: \"身份证\", prop: \"tourist_cert_id\", align: \"center\"},\r\n  {label: \"金额(元)\", prop: \"ticket_price\", align: \"center\"},\r\n  {label: \"购买时间\", prop: \"create_time\", align: \"center\"},\r\n  {label: \"有效期\", prop: \"ticket_date\", align: \"center\"},\r\n  {\r\n    label: \"操作\",\r\n    fixed: \"right\",\r\n    width: 180,\r\n    align: \"center\",\r\n    tdSlot: \"operate\", // 自定义单元格内容的插槽名称\r\n  },\r\n]);\r\n\r\nconst getList = async (data) => {\r\n  console.log(data);\r\n  keyWord.value = data.order;\r\n  let val = [];\r\n  if (data.order_status === 'order') {\r\n    await orderAjax(data).then(res => {\r\n      val = res.data;\r\n    });\r\n  } else {\r\n    await idcardAjax(data).then(res => {\r\n      if (res) {\r\n        val = res.data;\r\n      }\r\n    });\r\n  }\r\n  return {\r\n    data: val,\r\n    total: 0,\r\n  }\r\n}\r\n\r\n\r\nfunction isCardNo(card) {\r\n  // 身份证号码为15位或者18位，15位时全为数字，18位前17位为数字，最后一位是校验位，可能为数字或字符X\r\n  var reg = /(^\\d{15}$)|(^\\d{18}$)|(^\\d{17}(\\d|X|x)$)/;\r\n  if (reg.test(card) === false) {\r\n    return false;\r\n  } else {\r\n    return true;\r\n  }\r\n}\r\n\r\nasync function orderAjax() {\r\n  let option = {\r\n    order_sn: keyWord.value,\r\n  };\r\n  return await store.dispatch('orderListSearch', option);\r\n}\r\n\r\nasync function idcardAjax() {\r\n  let option = {\r\n    idcard: keyWord.value,\r\n  };\r\n  return await store.dispatch('orderListIdcard', option);\r\n}\r\n\r\n\r\nconst selectionVal = ref('');\r\n\r\nfunction submit(all = false, val) {\r\n  let id = null;\r\n  if (all) {\r\n    //多选\r\n    if (selectionVal.value === '') {\r\n      ElMessage({\r\n        message: '请选择数据' || 'error', type: 'warning', showClose: true, duration: 3 * 1000\r\n      });\r\n      return false;\r\n    }\r\n    id = selectionVal.value;\r\n  } else {\r\n    //单选\r\n    id = val.ticket_code;\r\n  }\r\n  ajax(id);\r\n}\r\n\r\nfunction ajax(id) {\r\n  let option = {\r\n    codes: id\r\n  }\r\n  store.dispatch('takeTickets', option).then(res => {\r\n    if (res.code === 0) {\r\n      proTable.value.refresh();\r\n      ElMessage({\r\n        message: res.msg || 'success', type: 'success', showClose: true, duration: 3 * 1000\r\n      });\r\n    } else {\r\n      ElMessage({\r\n        message: res.msg || 'error', type: 'warning', showClose: true, duration: 3 * 1000\r\n      });\r\n    }\r\n  });\r\n}\r\n\r\nfunction selection(e) {\r\n  if (e) {\r\n    let ids = e.map(item => {\r\n      return item.ticket_code;\r\n    });\r\n    ids = ids.join(\",\");\r\n    selectionVal.value = ids;\r\n  }\r\n}\r\n\r\n// 识别身份证\r\nconst fullscreenLoading = ref(false);\r\nconst websockets = ref(null), isconncet = ref(false);\r\n\r\nfunction socketChange() {\r\n  let state = websockets.value.readyState;\r\n  //读身份证\r\n  if (1 === state) {\r\n    isconncet.value = true;\r\n  }\r\n  if (3 === state) {\r\n    isconncet.value = false;\r\n  }\r\n}\r\n\r\nfunction OcrRecognition() {\r\n  if (!isconncet.value) {\r\n    // 1. 创建websockets对象，参数为服务器websockets地址\r\n    var url = \"ws:127.0.0.1:7415\"\r\n    websockets.value = new WebSocket(url);\r\n    websockets.value.onopen = () => socketChange();\r\n    //监听接收消息的情况\r\n    websockets.value.onmessage = (res) => {\r\n      if (res.data == \"failed to obtain ID card information\") {\r\n        return;\r\n      }\r\n      fullscreenLoading.value = false;\r\n      is_idCard.value = false;\r\n\r\n      var alldata = res.data.split(\"|\");\r\n      if (alldata.length >= 17) {\r\n        keyWord.value = alldata[6];\r\n        getList({pageNum: 1, pageSize: 50, order_status: 'idCard', order: keyWord.value})\r\n      } else {\r\n        ElMessage({\r\n          message: res.data,\r\n          type: 'warning',\r\n        })\r\n      }\r\n    }\r\n    //监听关闭时的状态变化\r\n  } else {\r\n    closeConnect();\r\n  }\r\n}\r\n\r\n/**\r\n *   关闭连接\r\n *\r\n */\r\nfunction closeConnect() {\r\n  websockets.value.close();\r\n}\r\n\r\nfunction ReadIDCard() {\r\n\r\n  if (!isconncet.value) {\r\n    ElMessage({\r\n      message: '未连接服务',\r\n      type: 'warning',\r\n    })\r\n  } else {\r\n    let paramTimeOut = 10000;\r\n    paramTimeOut = \"timeout=\" + paramTimeOut;\r\n    var parameterAll = paramTimeOut;\r\n    let val = \"03?\" + parameterAll;\r\n    websockets.value.send(val);\r\n    fullscreenLoading.value = true;\r\n  }\r\n}\r\n\r\n\r\nonMounted(() => {\r\n  OcrRecognition();\r\n});\r\n\r\n</script>\r\n<style>\r\nbody {\r\n\r\n}\r\n</style>\r\n\r\n<style scoped>\r\n.back {\r\n  width: 96%;\r\n  height: 100px;\r\n  line-height: 100px;\r\n  font-size: 26px;\r\n  margin: auto;\r\n  color: #ffffff;\r\n  font-weight: bold;\r\n  display: flex;\r\n  align-items: center;\r\n}\r\n\r\n.main {\r\n  width: calc(100% - 40px);\r\n  overflow: hidden;\r\n  left: 20px;\r\n  height: calc(100% - 120px);\r\n  bottom: 20px;\r\n  border-radius: 10px;\r\n  background-color: #ffffff;\r\n  position: absolute;\r\n  display: flex;\r\n  flex-direction: column;\r\n  justify-content: space-between;\r\n}\r\n\r\n.main-idCard {\r\n  position: absolute;\r\n  left: 20px;\r\n  height: calc(100% - 120px);\r\n  bottom: 20px;\r\n  width: calc(100% - 40px);\r\n  background-color: #ffffff;\r\n  z-index: 99999;\r\n  display: flex;\r\n  flex-direction: column;\r\n  justify-content: center;\r\n  align-items: center;\r\n  border-radius: 10px;\r\n}\r\n\r\n.idCard-text {\r\n  margin-bottom: 20px;\r\n  color: #224399;\r\n}\r\n\r\n.idCard {\r\n  width: 600px;\r\n  height: 400px;\r\n  border-radius: 20px;\r\n  background-color: #005eb710;\r\n}\r\n\r\n.idCard-button {\r\n  margin-top: 25px;\r\n}\r\n\r\n.table-box {\r\n  position: relative;\r\n  width: calc(100% - 40px);\r\n  height: 90%;\r\n  padding: 0 20px;\r\n}\r\n\r\n\r\n</style>","import script from \"./index.vue?vue&type=script&setup=true&lang=js\"\nexport * from \"./index.vue?vue&type=script&setup=true&lang=js\"\n\nimport \"./index.vue?vue&type=style&index=0&id=ed705dc2&lang=css\"\nimport \"./index.vue?vue&type=style&index=1&id=ed705dc2&scoped=true&lang=css\"\n\nimport exportComponent from \"../../../node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-ed705dc2\"]])\n\nexport default __exports__"],"names":["is_idCard","ref","store","useStore","proTable","keyWord","navtoback","router","push","path","columns","label","type","width","align","prop","fixed","tdSlot","getList","async","console","log","data","value","order","val","order_status","orderAjax","then","res","idcardAjax","total","option","order_sn","dispatch","idcard","selectionVal","submit","all","id","ElMessage","message","showClose","duration","ticket_code","ajax","codes","code","refresh","msg","selection","e","ids","map","item","join","fullscreenLoading","websockets","isconncet","socketChange","state","readyState","OcrRecognition","closeConnect","url","WebSocket","onopen","onmessage","alldata","split","length","pageNum","pageSize","close","ReadIDCard","paramTimeOut","parameterAll","send","onMounted","__exports__"],"sourceRoot":""}