"use strict";(self["webpackChunkticket"]=self["webpackChunkticket"]||[]).push([[578],{4576:function(e,a,t){t.r(a),t.d(a,{default:function(){return x}});t(7658);var l=t(3396),i=t(4870),n=t(9242),r=t.p+"img/bg2.f3b2c445.gif",o=t(5076),c=t(973),u=t(7178),s=t(6e3),d=t(65);const p=e=>((0,l.dD)("data-v-0886c342"),e=e(),(0,l.Cn)(),e),v={style:{height:"100vh"}},f={class:"back"},g={key:0,class:"main-idCard"},w=p((()=>(0,l._)("div",{class:"idCard-text"},"*请将身份证放到感应器上点击识别按钮",-1))),m=p((()=>(0,l._)("div",{class:"idCard"},[(0,l._)("div",{class:"idCard-bg"},[(0,l._)("img",{src:r})])],-1))),k={key:1,class:"main"},h={class:"table-box"},_={style:{padding:"20px 0 0 0"}};var y={__name:"index",setup(e){const a=(0,i.iH)(!0),t=(0,l.f3)("api"),r=(0,i.iH)(!0),p=(0,d.oR)(),y=(0,i.iH)(null),b=(0,i.iH)("");function C(){c.Z.push({path:"/main"})}const x=(0,i.iH)([{label:"",type:"selection",width:60},{label:"序号",type:"index",width:60,align:"center"},{label:"门票名称",prop:"ticket_title",width:240,align:"center"},{label:"订单号",prop:"trade_no",width:240,align:"center"},{label:"姓名",prop:"tourist_fullname",align:"center"},{label:"身份证",prop:"tourist_cert_id",align:"center"},{label:"金额(元)",prop:"ticket_price",align:"center"},{label:"购买时间",prop:"create_time",align:"center"},{label:"有效期",prop:"ticket_date",align:"center"},{label:"操作",fixed:"right",width:180,align:"center",tdSlot:"operate"}]),H=async e=>{b.value=e.order;let a=[];return"order"===e.order_status?await z(e).then((e=>{a=e.data})):await S(e).then((e=>{e&&(a=e.data)})),{data:a,total:0}};async function z(){let e={order_sn:b.value};return await p.dispatch("orderListSearch",e)}async function S(){let e={idcard:b.value};return await p.dispatch("orderListIdcard",e)}const T=(0,i.iH)("");function W(e=!1,a){let t=null;if(e){if(""===T.value)return(0,u.z8)({message:"请选择数据",type:"warning",showClose:!0,duration:3e3}),!1;t=T.value}else t=a.ticket_code;D(t)}function D(e){let a={codes:e};p.dispatch("takeTickets",a).then((e=>{0===e.code?(y.value.refresh(),(0,u.z8)({message:e.msg||"success",type:"success",showClose:!0,duration:3e3})):(0,u.z8)({message:e.msg||"error",type:"warning",showClose:!0,duration:3e3})}))}function U(e){if(e){let a=e.map((e=>e.ticket_code));a=a.join(","),T.value=a}}const j=(0,i.iH)(!1),q=(0,i.iH)(null),B=(0,i.iH)(!1);function I(){let e=q.value.readyState;1===e&&(B.value=!0),3===e&&(B.value=!1)}function L(){if(B.value)Z();else{var e="ws:127.0.0.1:7415";q.value=new WebSocket(e),console.log(q.value),q.value.onopen=()=>I(),q.value.onmessage=e=>{if("failed to obtain ID card information"!=e.data){j.value=!1,r.value=!1,a.value=!0;var t=e.data.split("|");t.length>=17?b.value=t[6]:(0,u.z8)({message:e.data,type:"warning"})}}}}function Z(){q.value.close()}function V(){if(B.value){a.value=!1,b.value="";let t=1e4;t="timeout="+t;var e=t;let l="03?"+e;q.value.send(l),j.value=!0}else r.value=!1,s.T.confirm("未连接服务! 请打开服务、驱动未安装,请安装驱动后重试！","Warning",{confirmButtonText:"下载驱动",cancelButtonText:"取消",type:"warning"}).then((()=>{window.open(t.urli+"download/drive.zip")})).catch((()=>{}))}return(0,l.bv)((()=>{L()})),(e,t)=>{const c=(0,l.up)("ArrowLeftBold"),u=(0,l.up)("el-icon"),s=(0,l.up)("el-button"),d=(0,l.Q2)("loading");return(0,l.wg)(),(0,l.iD)("div",v,[(0,l._)("div",f,[(0,l.Wm)(u,null,{default:(0,l.w5)((()=>[(0,l.Wm)(c)])),_:1}),(0,l._)("text",{style:{"margin-left":"10px"},onClick:t[0]||(t[0]=e=>C())},"返回首页")]),r.value?((0,l.wg)(),(0,l.iD)("div",g,[w,m,(0,l.wy)(((0,l.wg)(),(0,l.j4)(s,{class:"idCard-button",type:"primary",onClick:V},{default:(0,l.w5)((()=>[(0,l.Uk)("点击识别 ")])),_:1})),[[d,j.value,void 0,{fullscreen:!0,lock:!0}]])])):(0,l.kq)("",!0),r.value?(0,l.kq)("",!0):((0,l.wg)(),(0,l.iD)("div",k,[(0,l._)("div",h,[a.value?((0,l.wg)(),(0,l.j4)((0,i.SU)(o.Z),{key:0,columns:x.value,request:H,ref_key:"proTable",ref:y,stripe:"",border:"",hideTitleBar:!0,onSelectionChange:U,pagination:!1,search:{fields:[{type:"select",label:"类型",name:"order_status",defaultValue:"idCard",options:[{value:"order",name:"订单号"},{value:"idCard",name:"身份证号"}]},{type:"input",label:"编号/身份证",name:"order",defaultValue:b.value}]}},{operate:(0,l.w5)((e=>[(0,l.Wm)(s,{size:"mini",type:"primary",onClick:(0,n.iM)((a=>W(!1,e.row)),["prevent"])},{default:(0,l.w5)((()=>[(0,l.Uk)("打印门票")])),_:2},1032,["onClick"])])),_:1},8,["columns","search"])):(0,l.kq)("",!0),(0,l._)("div",_,[(0,l.wy)(((0,l.wg)(),(0,l.j4)(s,{type:"primary",onClick:V},{default:(0,l.w5)((()=>[(0,l.Uk)("识别身份证 ")])),_:1})),[[d,j.value,void 0,{fullscreen:!0,lock:!0}]]),(0,l.Wm)(s,{type:"primary",onClick:t[1]||(t[1]=e=>W(!0,{}))},{default:(0,l.w5)((()=>[(0,l.Uk)("打印选中门票")])),_:1})])])]))])}}},b=t(89);const C=(0,b.Z)(y,[["__scopeId","data-v-0886c342"]]);var x=C}}]);
//# sourceMappingURL=578.3f438a97.js.map