"use strict";(self["webpackChunkticket"]=self["webpackChunkticket"]||[]).push([[270],{4413:function(e,t,a){a.r(t),a.d(t,{default:function(){return C}});a(7658);var l=a(3396),i=a(4870),n=a(9242),r=a.p+"img/bg2.f3b2c445.gif",o=a(5076),s=a(973),c=a(7178),d=a(65);const u=e=>((0,l.dD)("data-v-ed705dc2"),e=e(),(0,l.Cn)(),e),p={style:{height:"100vh"}},v={class:"back"},g={key:0,class:"main-idCard"},f=u((()=>(0,l._)("div",{class:"idCard-text"},"*请将身份证放到感应器上点击识别按钮",-1))),m=u((()=>(0,l._)("div",{class:"idCard"},[(0,l._)("div",{class:"idCard-bg"},[(0,l._)("img",{src:r})])],-1))),w={key:1,class:"main"},_={class:"table-box"},k={style:{padding:"0 20px 0"}};var h={__name:"index",setup(e){const t=(0,i.iH)(!0),a=(0,d.oR)(),r=(0,i.iH)(null),u=(0,i.iH)("");function h(){s.Z.push({path:"/main"})}const y=(0,i.iH)([{label:"",type:"selection",width:60},{label:"序号",type:"index",width:60,align:"center"},{label:"门票名称",prop:"ticket_title",width:240,align:"center"},{label:"订单号",prop:"trade_no",width:240,align:"center"},{label:"姓名",prop:"tourist_fullname",align:"center"},{label:"身份证",prop:"tourist_cert_id",align:"center"},{label:"金额(元)",prop:"ticket_price",align:"center"},{label:"购买时间",prop:"create_time",align:"center"},{label:"有效期",prop:"ticket_date",align:"center"},{label:"操作",fixed:"right",width:180,align:"center",tdSlot:"operate"}]),b=async e=>{console.log(e),u.value=e.order;let t=[];return"order"===e.order_status?await C(e).then((e=>{t=e.data})):await x(e).then((e=>{e&&(t=e.data)})),{data:t,total:0}};async function C(){let e={order_sn:u.value};return await a.dispatch("orderListSearch",e)}async function x(){let e={idcard:u.value};return await a.dispatch("orderListIdcard",e)}const H=(0,i.iH)("");function z(e=!1,t){let a=null;if(e){if(""===H.value)return(0,c.z8)({message:"请选择数据",type:"warning",showClose:!0,duration:3e3}),!1;a=H.value}else a=t.ticket_code;S(a)}function S(e){let t={codes:e};a.dispatch("takeTickets",t).then((e=>{0===e.code?(r.value.refresh(),(0,c.z8)({message:e.msg||"success",type:"success",showClose:!0,duration:3e3})):(0,c.z8)({message:e.msg||"error",type:"warning",showClose:!0,duration:3e3})}))}function W(e){if(e){let t=e.map((e=>e.ticket_code));t=t.join(","),H.value=t}}const D=(0,i.iH)(!1),U=(0,i.iH)(null),j=(0,i.iH)(!1);function q(){let e=U.value.readyState;1===e&&(j.value=!0),3===e&&(j.value=!1)}function I(){if(j.value)L();else{var e="ws:127.0.0.1:7415";U.value=new WebSocket(e),U.value.onopen=()=>q(),U.value.onmessage=e=>{if("failed to obtain ID card information"!=e.data){D.value=!1,t.value=!1;var a=e.data.split("|");a.length>=17?(u.value=a[6],b({pageNum:1,pageSize:50,order_status:"idCard",order:u.value})):(0,c.z8)({message:e.data,type:"warning"})}}}}function L(){U.value.close()}function T(){if(j.value){let t=1e4;t="timeout="+t;var e=t;let a="03?"+e;U.value.send(a),D.value=!0}else(0,c.z8)({message:"未连接服务",type:"warning"})}return(0,l.bv)((()=>{I()})),(e,a)=>{const s=(0,l.up)("ArrowLeftBold"),c=(0,l.up)("el-icon"),d=(0,l.up)("el-button"),u=(0,l.Q2)("loading");return(0,l.wg)(),(0,l.iD)("div",p,[(0,l._)("div",v,[(0,l.Wm)(c,null,{default:(0,l.w5)((()=>[(0,l.Wm)(s)])),_:1}),(0,l._)("text",{style:{"margin-left":"10px"},onClick:a[0]||(a[0]=e=>h())},"返回首页")]),t.value?((0,l.wg)(),(0,l.iD)("div",g,[f,m,(0,l.wy)(((0,l.wg)(),(0,l.j4)(d,{class:"idCard-button",type:"primary",onClick:T},{default:(0,l.w5)((()=>[(0,l.Uk)("点击识别 ")])),_:1})),[[u,D.value,void 0,{fullscreen:!0,lock:!0}]])])):(0,l.kq)("",!0),t.value?(0,l.kq)("",!0):((0,l.wg)(),(0,l.iD)("div",w,[(0,l._)("div",_,[(0,l.Wm)((0,i.SU)(o.Z),{columns:y.value,request:b,ref_key:"proTable",ref:r,stripe:"",border:"",hideTitleBar:!0,onSelectionChange:W,pagination:!1,search:{fields:[{type:"select",label:"类型",name:"order_status",options:[{value:"order",name:"订单号"},{value:"idCard",name:"身份证号"}]},{type:"input",label:"编号/身份证",name:"order"}]}},{operate:(0,l.w5)((e=>[(0,l.Wm)(d,{size:"mini",type:"primary",onClick:(0,n.iM)((t=>z(!1,e.row)),["prevent"])},{default:(0,l.w5)((()=>[(0,l.Uk)("打印门票")])),_:2},1032,["onClick"])])),_:1},8,["columns"]),(0,l._)("div",k,[(0,l.wy)(((0,l.wg)(),(0,l.j4)(d,{type:"primary",onClick:T},{default:(0,l.w5)((()=>[(0,l.Uk)("识别身份证 ")])),_:1})),[[u,D.value,void 0,{fullscreen:!0,lock:!0}]]),(0,l.Wm)(d,{type:"primary",onClick:a[1]||(a[1]=e=>z(!0,{}))},{default:(0,l.w5)((()=>[(0,l.Uk)("打印选中门票")])),_:1})])])]))])}}},y=a(89);const b=(0,y.Z)(h,[["__scopeId","data-v-ed705dc2"]]);var C=b}}]);
//# sourceMappingURL=270.5a19cbf3.js.map