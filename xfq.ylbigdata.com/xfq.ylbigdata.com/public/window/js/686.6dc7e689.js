"use strict";(self["webpackChunkticket"]=self["webpackChunkticket"]||[]).push([[686],{1506:function(e,t,a){a.r(t),a.d(t,{default:function(){return g}});var n=a(3396),l=a(4870),i=a(9242),r=a(5332),o=a(7178),u=a(6e3),c=a(65);const s={class:"main backdrop-filter"},d={class:"table-box"},p={style:{padding:"0 20px 0"}};var v={__name:"index",setup(e){const t=(0,l.iH)(!0),a=(0,l.iH)(null),v=(0,n.f3)("api"),f=(0,c.oR)(),w=(0,l.iH)(""),g=(0,l.iH)([{label:"",type:"selection",width:60},{label:"序号",type:"index",width:60,align:"center"},{label:"门票名称",prop:"ticket_title",width:240,align:"center"},{label:"订单号",prop:"trade_no",width:240,align:"center"},{label:"金额(元)",prop:"ticket_price",align:"center"},{label:"购买时间",prop:"create_time",align:"center"},{label:"有效期",prop:"ticket_date",align:"center"},{label:"操作",fixed:"right",width:180,align:"center",tdSlot:"operate"}]),k=async e=>{w.value=e.order;let t=[];return"order"===e.order_status?await h(e).then((e=>{t=e.data})):await m(e).then((e=>{e&&(t=e.data)})),{data:t,total:0}};async function h(){let e={order_sn:w.value};return await f.dispatch("orderListSearch",e)}async function m(){let e={idcard:w.value};return await f.dispatch("orderListIdcard",e)}const y=(0,l.iH)("");function b(e=!1,t){let a=null;if(e){if(""===y.value)return(0,o.z8)({message:"请选择数据",type:"warning",showClose:!0,duration:3e3}),!1;a=y.value}else a=t.ticket_code;_(a)}function _(e){let t={codes:e};f.dispatch("takeTickets",t).then((e=>{0===e.code?((0,o.z8)({message:e.msg||"success",type:"success",showClose:!0,duration:3e3}),a.value.refresh()):(0,o.z8)({message:e.msg||"error",type:"warning",showClose:!0,duration:3e3})}))}function C(e){if(e){let t=e.map((e=>e.ticket_code));t=t.join(","),y.value=t}}const H=(0,l.iH)(!1),x=(0,l.iH)(null),z=(0,l.iH)(!1);function S(){let e=x.value.readyState;1===e&&(z.value=!0),3===e&&(z.value=!1)}function T(){if(z.value)j();else{var e="ws:127.0.0.1:7415";x.value=new WebSocket(e),x.value.onopen=()=>S(),x.value.onmessage=e=>{if("failed to obtain ID card information"!=e.data){H.value=!1;var a=e.data.split("|");a.length>=17?(w.value=a[6],t.value=!0):(t.value=!0,(0,o.z8)({message:e.data,type:"warning"}))}}}}function j(){x.value.close()}function U(){if(z.value){let a=1e4;a="timeout="+a;var e=a;let n="03?"+e;x.value.send(n),H.value=!0,t.value=!1,w.value=""}else u.T.confirm("未连接服务! 请打开服务、驱动未安装,请安装驱动后重试！","Warning",{confirmButtonText:"下载驱动",cancelButtonText:"取消",type:"warning"}).then((()=>{window.open(v.urli+"download/drive.zip")})).catch((()=>{}))}return(0,n.bv)((()=>{T()})),(e,o)=>{const u=(0,n.up)("el-button"),c=(0,n.Q2)("loading");return(0,n.wg)(),(0,n.iD)("div",s,[(0,n._)("div",d,[t.value?((0,n.wg)(),(0,n.j4)((0,l.SU)(r.Z),{key:0,columns:g.value,request:k,ref_key:"proTable",ref:a,stripe:"",border:"",hideTitleBar:!0,onSelectionChange:C,pagination:!1,search:{fields:[{type:"select",label:"类型",name:"order_status",defaultValue:"idCard",options:[{value:"order",name:"订单号"},{value:"idCard",name:"身份证号"}]},{type:"input",label:"编号/身份证",name:"order",defaultValue:w.value}]}},{operate:(0,n.w5)((e=>[(0,n.Wm)(u,{size:"mini",type:"primary",onClick:(0,i.iM)((t=>b(!1,e.row)),["prevent"])},{default:(0,n.w5)((()=>[(0,n.Uk)("打印门票")])),_:2},1032,["onClick"])])),_:1},8,["columns","search"])):(0,n.kq)("",!0),(0,n._)("div",p,[(0,n.wy)(((0,n.wg)(),(0,n.j4)(u,{type:"primary",onClick:U},{default:(0,n.w5)((()=>[(0,n.Uk)("识别身份证 ")])),_:1})),[[c,H.value,void 0,{fullscreen:!0,lock:!0}]]),w.value?((0,n.wg)(),(0,n.j4)(u,{key:0,type:"primary",onClick:o[0]||(o[0]=e=>b(!0,{}))},{default:(0,n.w5)((()=>[(0,n.Uk)("打印选中门票")])),_:1})):(0,n.kq)("",!0)])])])}}},f=a(89);const w=(0,f.Z)(v,[["__scopeId","data-v-a6cb52c4"]]);var g=w}}]);
//# sourceMappingURL=686.6dc7e689.js.map