<!--内容开始-->
<section class="content">
    <!--顶部提示开始-->
    <!--顶部提示结束-->
    <div class="container-fluid">
        <div class="row">
            <!--搜索区域开始-->
            <div class="col-12 search-collapse">
                <form id="search_form" name="search_form">
                    <div class="select-list">
                        <ul>
                            <li>
                                <label>预约人：</label>
                                <input type="text" name="fullname" value="" placeholder="请输入预约人">
                            </li>
                            <li>
                                <label>预约人证件号：</label>
                                <input type="text" name="idcard" value="" placeholder="请输入预约人证件号">
                            </li>
                            <li>
                                <label>预约人手机号：</label>
                                <input type="text" name="phone" value="" placeholder="请输入预约人手机号">
                            </li>
                            <li>
                                <label>预约日期：</label>
                                <input data-datepicker autocomplete="off" type="text" name="date" value="" placeholder="请选择日期">
                            </li>
                            <li>
                                <label>创建时间：</label>
                                <input type="text" data-daterangepicker autocomplete="off" name="create_time_range"  placeholder="请选择创建日期范围" value="">
                            </li>
                            <li>
                                <label>状态：</label>
                                <select class="" name="status">
                                    <option value="">请选择</option>
                                    <option value="0">待核销</option>
                                    <option value="1">已核销</option>
                                </select>
                            </li>
                            <li>
                                <a class="btn btn-primary btn-rounded btn-sm" onclick="$.table.search()">&nbsp;搜索</a> <a class="btn btn-warning btn-rounded btn-sm" onclick="resetPre()">&nbsp;重置</a> <input class="hide" type="submit" name="btnSave" value="提交" onclick="$.table.search();return false;">
                            </li>
                        </ul>
                    </div>
                </form>
            </div>
            <!--搜索区域结束-->
            <div class="col-sm-12 select-table table-striped">
                <div class="btn-group-sm" id="toolbar" role="group">
                </div>
                <table id="bootstrap-table" class="projects" data-mobile-responsive="true"></table>
            </div>
        </div>
    </div>
    <script>
        $(function() {
            var options = {
                uniqueId      : "id",         // 表格主键名称，（默认为id，如表主键不为id必须设置主键）
                url           : "/seller/appt.log/index.html",      // 请求后台的URL
                sortOrder     : "desc",                 // 排序方式  asc 或者 desc
                pagination    : true,			// 是否进行分页
                parentIdField : "pid",   // 列表树模式需传递父id字段名（parent_id/pid）
                clickToSelect : true,				    // 默认false不响应，设为true则当点击此行的某处时，会自动选中此行的checkbox/radiobox
                pageSize      : "10",         // 每页显示的行数
                layerOpen     : "1",        // 添加/编辑等页启用layer弹层加载
                emptyTips     : "没有找到匹配的记录",        // 空数据提示信息
                fixedColumns  : true,                   // 是否启用固定列功能
                fixedLeft     : 0,          // 左侧固定列数
                fixedRight    : 1,         // 右侧固定列数
                columns: [

                    {
                        field: 'id',
                        title: 'ID',
                        sortable: true,
                        align:'center',
                    },
                    {
                        title: '预约时段',
                        align:'center',
                        formatter: function(value, row, index) {
                            return row.date + ' ' + row.time_start_text +'~' + row.time_end_text;
                        }
                    },
                    {
                        field: 'users',
                        title: '预约用户',
                        formatter:function (value, row, index){
                            if(row.users){
                                return `<img alt="${row.users.nickname}" class="table-avatar mr-1" src="${row.users.headimgurl}">  ${row.users.nickname}`;
                            }else{
                                return "未知用户";
                            }
                        }
                    },
                    {
                        field: 'fullname',
                        title: '预约人',
                    },
                    {
                        field: 'phone',
                        title: '预约人电话',
                    },
                    {
                        field: 'idcard',
                        title: '预约人身份证号'
                    },
                    {
                        field: 'number',
                        title: '预约人数',
                        align: 'center'
                    },
                    {
                        field: 'ip',
                        title: 'IP地址',
                        align: 'center'
                    },
                    {
                        field: 'create_time',
                        title: '创建时间'
                    },
                    {
                        field: 'status_text',
                        title: '状态'
                    },
                    {
                        field: 'right_button',
                        title: '操作',
                        sortable: false,
                        class : 'text-nowrap',
                        formatter: function(value, row, index) {
                            let row_json = JSON.stringify(row);
                            var actions = [];
                            actions.push(`<a class="btn btn-primary btn-xs" target="" href="javascript:void(0)" onclick="doPrint('${encodeURIComponent(row_json)}')"><i class="fa fa-print"></i> 打印</a> `);
                            actions.push('<a class="btn btn-primary btn-xs" target="" href="javascript:void(0)" onclick="see(\'/seller/appt.log/detail.html?_layer=1&id='+row.id+'\')"><i class="fa fa-eye"></i> 查看</a> ');
                            return actions.join('');
                        }
                    },
                ]
            };
            $.table.init(options);

                /*$('input[name="date_range"]').daterangepicker({
                    autoUpdateInput: false,
                    showDropdowns: true,
                    locale: {
                        format: "YYYY-MM-DD",
                        applyLabel: '确定',       // 确定按钮文本
                        cancelLabel: '取消',      // 取消按钮文本
                        customRangeLabel: '自定义',
                    }
                }).on('cancel.daterangepicker', function (ev, picker) {
                    $(this).val("");
                }).on('apply.daterangepicker', function (ev, picker) {
                    console.log(picker)
                    $(this).val(picker.startDate.format('YYYY-MM-DD') + " 至 " + picker.endDate.format('YYYY-MM-DD'));
                });*/
        });

        // 搜索
        function searchPre() {
            var data = {};
            $.table.search('', data);
        }

        // 重置搜索
        function resetPre() {
            $.form.reset();
        }
        //HTML反转义
        function HTMLDecode(text) {
            var temp = document.createElement("div");
            temp.innerHTML = text;
            var output = temp.innerText || temp.textContent;
            temp = null;
            return output;
        }
        // 添加商户
        function add(id) {
            var url = $.operate.addUrl(id)
            if ($.table._option.layerOpen == "1") {
                // 通过参数隐藏左侧和顶部等数据
                if (url.indexOf('?') != -1) {
                    url = url + '&_layer=1'
                } else {
                    url = url + '?_layer=1'
                }
                // 弹窗打开要添加的地址
                $.modal.open("添加", url);
            } else {
                // 当前窗口打开要添加的地址
                $.common.jump(url);
            }
        }

        // 编辑商户
        function edit(id) {
            var url = $.operate.editUrl(id)
            if ($.table._option.layerOpen == "1") {
                // 通过参数隐藏左侧和顶部等数据
                if (url.indexOf('?') != -1) {
                    url = url + '&_layer=1'
                } else {
                    url = url + '?_layer=1'
                }
                // 弹窗打开要添加的地址
                $.modal.open("编辑", url);
            } else {
                // 当前窗口打开要添加的地址
                $.common.jump(url);
            }
        }
        function see(url){
            let area  =   [800 + 'px', 600 + 'px'];
            layer.open({
                type: 2,
                maxmin: true,
                shade: 0.3,
                title: '查看',
                fix: false,
                area: area,
                content: url,
                cancel: function () {
                    return true;
                }
            });
        }
        function doPrint(row){
            row = decodeURIComponent(row);
            row = JSON.parse(row);
            console.log(row);
            let html = `<div id="print_box" style="padding: 16px;line-height:1.2;color:#666;"><h4>预约日期：${row.date}</h4><p>预约人：${row.fullname}</p><p>预约人电话：${row.phone}</p><p>预约人数：2人</p><p>预约单号：${row.code}</p><p>创建时间：${row.create_time}</p>`;
            for(let item of row.tourist_list){
                html += `<hr />`;
                html += `<p>${item.tourist_fullname}</p>`;
                html += `<p>${item.tourist_fullname}电话：${item.tourist_mobile}</p>`;
                html += `<p>${item.tourist_fullname}证件号：${item.tourist_cert_id}</p>`;

            }
            html += `<hr />`;
            html += `</div><button class="layui-btn layui-bg-blue layui-btn-sm m-3" onclick="print()">打印</button>`;
            layer.open({
                type: 1,
                content: html
            });
        }
        //print_box
        function print(){
                let element = document.getElementById("print_box");
                console.log(element)
                let printWindow = window.open('', '_blank');
                printWindow.document.write('<html><head><title>预约信息</title></head><body>');
                printWindow.document.write(element.innerHTML);
                printWindow.document.write('</body></html>');
                printWindow.document.close();
                printWindow.print();
        }
    </script>

    <!--bootstrap table end-->

    <!--底部提示-->
</section>