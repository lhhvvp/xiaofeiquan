
                        <!--内容开始-->
<section class="content">


<!--顶部提示开始-->
<!--顶部提示结束-->
<div class="container-fluid">
    <div class="row">
        <!--搜索区域开始-->
<div class="col-12 search-collapse">
    <form id="search_form">
        <div class="select-list">
                        <ul>
                        <li>
                                <label>消费券种类：</label> <select id="search_issue_coupon_class_id" name="issue_coupon_class_id">
                                    <option value="">
                                        所有
                                    </option>
                                    {volist name="class_list" id="item"}
                                    <option value="{$item.id}">
                                        {$item.title}
                                    </option>
                                    {/volist}
                                </select>
                            </li>

                                <li>
                    <label>消费券标题： </label>

                            <input type="text" id="search_coupon_title" name="coupon_title"  placeholder="请输入消费券标题"/>
                                                            </li>

                                                            <li>
                    <label>领取ID： </label>

                            <input type="text" id="search_receive_id" name="receive_id"  placeholder="请输入领取ID"/>
                                                            </li>
                        <li>
                        <label>状态：</label> <select id="search_status" name="status">
                            <option value="">
                                所有
                            </option>
                            <option value="0">
                                未使用
                            </option>
                            <option value="1">
                                已使用
                            </option>
                            <option value="2">
                                已过期
                            </option>
                        </select>
                    </li>
                                <li>
                    <label>领取人： </label>

                            <input type="text" id="search_uid" name="uid" value=""/>
                                        </li>
                                <li>
                    <a class="btn btn-primary btn-rounded btn-sm" onclick="$.table.search()"><i class="fa fa-search"></i>&nbsp;搜索</a>
                    <a class="btn btn-warning btn-rounded btn-sm" onclick="resetPre()"><i class="fas fa-sync-alt"></i>&nbsp;重置</a>
                    <input class="hide" type="submit" name="btnSave" value="提交" onclick="$.table.search();return false;"/>
                </li>
            </ul>
                    </div>
    </form>
</div>
            <!--列表区域开始-->
            <div class="col-sm-12 select-table table-striped">
                <div class="btn-group-sm" id="toolbar" role="group">
            <a class="btn btn-warning"  onclick="$.table.export()">
            <i class="fa fa-download"></i> 导出        </a>
            </div>
                <table id="bootstrap-table" data-mobile-responsive="true"></table>
            </div>
        </div>
    </div>
    <script>
        $(function() {
            var options = {
                uniqueId      : "id",         // 表格主键名称，（默认为id，如表主键不为id必须设置主键）
                url           : "/admin/CouponIssueUser/index.html?getList=1",      // 请求后台的URL
                addUrl        : "/admin/CouponIssueUser/add.html",       // 新增的地址
                editUrl       : "/admin/CouponIssueUser/edit.html?id=__id__",      // 修改的地址
                delUrl        : "/admin/CouponIssueUser/del.html",       // 删除的地址
                exportUrl     : "/admin/CouponIssueUser/export.html",    // 导出的地址
                sortUrl       : "/admin/CouponIssueUser/sort.html",      // 排序的地址
                sortName      : "id",         // 排序列名称
                sortOrder     : "desc",                 // 排序方式  asc 或者 desc
				pagination    : true,			// 是否进行分页
                parentIdField : "",   // 列表树模式需传递父id字段名（parent_id/pid）
				clickToSelect : true,				    // 默认false不响应，设为true则当点击此行的某处时，会自动选中此行的checkbox/radiobox
                pageSize      : "10",         // 每页显示的行数
                layerOpen     : "1",        // 添加/编辑等页启用layer弹层加载
                emptyTips     : "没有找到匹配的记录",        // 空数据提示信息
                fixedColumns  : true,                   // 是否启用固定列功能
                fixedLeft     : 0,          // 左侧固定列数
                fixedRight    : 1,         // 右侧固定列数
                columns: [
                    {
                        //field: 'state',
                        checkbox: true,
						// 当某行包含checkbox_disabled时禁止选择
						formatter: function(value, row, index) {
							if(row.checkbox_disabled =='1'){
								 return {
									 disabled : true
								}
							 }
						}
                    },
                                            {
                            field: 'id',
                            title: '编号',

                                                            sortable: true,

                        },
                                            {
                            field: 'issue_coupon_class_id',
                            title: '消费券种类',

                                                            sortable: false,    formatter: function(value, row, index) {
                                        return (row.couponClass.title);
                                    }

                        },
                                            {
                            field: 'issue_coupon_id',
                            title: '消费券名称',

                                                            sortable: true, formatter: function(value, row, index) {
                                        return (row.couponIssue.coupon_title);
                                    }

                        },
                                            {
                            field: 'coupon_price',
                            title: '消费券面额',

                                                            sortable: false,

                        },
                                            {
                            field: 'time_use',
                            title: '消费券使用时间',

                                                            sortable: false,
                                                                formatter: function(value, row, index) {
                                        return changeDateFormat(value);
                                    }

                        },
                                            {
                            field: 'is_fail',
                            title: '是否有效',

                                                            sortable: true,
                                                            formatter: function(value, row, index) {
                                    if (value == 0) {
                                        return '<span class="badge badge-danger">否</span>';
                                    } else if (value == 1) {
                                        return '<span class="badge badge-primary">是</span>';
                                    }
                                }

                        },
                                            {
                            field: 'status',
                            title: '状态',

                                                            sortable: true,
                                                            formatter: function(value, row, index) {
                                                                if (value == 0) {
                                        return '<span class="badge badge-danger">未使用</span>';
                                    } else if (value == 1) {
                                        return '<span class="badge badge-primary">已使用</span>';
                                    } else {
                                        return '<span class="badge badge-danger">已过期</span>';
                                    }
                                }

                        },
                                            {
                            field: 'ips',
                            title: '领取区域',

                                                            sortable: false,
                            										formatter: function(value, row, index) {
											return HTMLDecode(value);
										}

                        },
                                            {
                            field: 'expire_time',
                            title: '消费券到期时间',

                                                            sortable: false,
                                                                formatter: function(value, row, index) {
                                        return changeDateFormat(value);
                                    }

                        },
                                            {
                            field: 'uid',
                            title: '领取人',

                                                            sortable: true,formatter: function(value, row, index) {
                                        return (row.users.name);
                                    }

                        },
                                            {
                            field: 'users.mobile',
                            title: '手机号',

                                                            sortable: false,
                                                                    formatter: function(value, row, index) {
                                            return HTMLDecode(value);
                                        }

                        },
                                            {
                            field: 'users.idcard',
                            title: '身份证号',

                                                            sortable: false,
                                                                    formatter: function(value, row, index) {
                                            return HTMLDecode(value);
                                        }

                        },
                                            {
                            field: 'create_time',
                            title: '领取时间',

                                                            sortable: false,
                                                                formatter: function(value, row, index) {
                                        return changeDateFormat(value);
                                    }

                        },
                                            {
                            field: 'right_button',
                            title: '操作',

                                                            sortable: false,
                                                                class : 'text-nowrap',
									formatter: function(value, row, index) {
										var actions = [];
																				if('' == 'edit' || '' == 'preview'){
                                            if('/admin/CouponIssueUser/see.html?parentId=__id__'){
                                                var url = '/admin/CouponIssueUser/see.html?parentId=__id__';
                                                var reg = /__(.*?)__/g;
                                                // 匹配ID和email，可能为任何的其他参数，但都是 __字段__ 格式
                                                while (result = reg.exec(url)) {
                                                    url = url.replace(result[0], row[result[1]]);
                                                }
                                                actions.push('<a class="btn btn-primary btn-xs" onclick="see(\'' + url + '\')"><i class="fa fa-edit"></i> 查看</a> ');
                                            }else{
                                                actions.push('<a class="btn btn-primary btn-xs" href="javascript:void(0)" onclick="$.operate.edit(\'' + row.id + '\')"><i class="fa fa-search"></i> 查看</a> ');
                                            }
										} else if ('' == 'delete'){
                                            if('/admin/CouponIssueUser/see.html?parentId=__id__'){
                                                var url = '/admin/CouponIssueUser/see.html?parentId=__id__';
                                                var reg = /__(.*?)__/g;
                                                // 匹配ID和email，可能为任何的其他参数，但都是 __字段__ 格式
                                                while (result = reg.exec(url)) {
                                                    url = url.replace(result[0], row[result[1]]);
                                                }
                                                actions.push('<a class="btn btn-primary btn-xs" onclick="see(\'' + url + '\')"><i class="fa fa-edit"></i> 查看</a> ');
                                            }else{
                                                actions.push('<a class="btn btn-primary btn-xs" href="javascript:void(0)" onclick="$.operate.remove(\'' + row.id + '\')"><i class="fa fa-search"></i> 查看</a> ');
                                            }
										} else {
											var url = '/admin/CouponIssueUser/see.html?parentId=__id__';
											var reg = /__(.*?)__/g;
											// 匹配ID和email，可能为任何的其他参数，但都是 __字段__ 格式
											while (result = reg.exec(url)) {
												url = url.replace(result[0], row[result[1]]);
											}
                                            actions.push('<a class="btn btn-primary btn-xs" onclick="see(\'' + url + '\')"><i class="fa fa-edit"></i> 查看</a> ');
										}

																				return actions.join('');
									}

                        },
                                    ]
            };
            $.table.init(options);
        });

        // 搜索
        function searchPre() {
            var data = {};
            $.table.search('', data);
        };
        function isMobile() {
            let flag = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
            return flag;
        };
         function see(url) {

             let area  =  [];
             if (isMobile()) {
                 area  =  [100 + '%', 100 + '%']
             } else {
                 area  =  [900 + 'px', 700 + 'px']
             }

             if ($.table._option.layerOpen == "1") {
                 // 通过参数隐藏左侧和顶部等数据
                 if (url.indexOf('?') != -1) {
                     url = url + '&_layer=1'
                 } else {
                     url = url + '?_layer=1'
                 }
                 var index = layer.open({
                     type: 2,
                     maxmin: true,
                     shade: 0.3,
                     title: '查看',
                     fix: false,
                     area: area,
                     content: url,
                     cancel: function () {
                         return true;
                     }
                 });

                 // 弹窗打开要添加的地址
                 // $.modal.open("查看", url);
             } else {
                 // 当前窗口打开要添加的地址
                 $.common.jump(url);
             }
         }

        // 重置搜索
        function resetPre() {
            $.form.reset();
        }
		//HTML反转义
		function HTMLDecode(text) {
			var temp = document.createElement("div");
			temp.innerHTML = text;
			var output = temp.innerText || temp.textContent;
			temp = null;
			return output;
		}
    </script>

    <!--bootstrap table end-->

    <!--底部提示-->


    </section>
<!--内容结束-->