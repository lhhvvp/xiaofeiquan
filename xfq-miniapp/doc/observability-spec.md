# 可观测性规范（埋点 / 监控 / 日志）

目标：上线后出现问题能“快速发现、快速定位、快速止血”，并能量化重构收益。

---

## 1. 事件命名规范（建议）
- 业务事件：`biz_<domain>_<action>`（例：`biz_coupon_claim_success`）
- 页面事件：`page_<path>_<action>`（例：`page_coupon_detail_view`）
- 错误事件：`err_<module>_<type>`（例：`err_request_timeout`）

统一字段（每个事件都带上）：
- `app_version`：版本号
- `env`：develop / trial / release
- `page`：当前页面 path
- `uid`：用户 ID（若已登录）
- `trace_id`：链路追踪 ID（由请求层生成并贯穿）
- `ts`：时间戳

---

## 2. 关键链路必须覆盖的埋点
- 登录：开始/成功/失败（失败原因分类）
- 领券/用券：点击/成功/失败（失败原因、券类型、券ID）
- 下单：提交/成功/失败（价格、库存、商品ID）
- 支付：拉起支付/成功/取消/失败（订单ID、金额、失败原因）
- 退款：申请/成功/失败（订单ID、原因）
- 核销/二维码：展示/刷新/过期/核销成功/失败

---

## 3. 监控指标（建议看板）

### 3.1 稳定性
- JS 错误率、崩溃率
- 接口错误率（按 endpoint、业务错误码聚合）

### 3.2 交易
- 支付成功率、取消率、失败率
- 退款成功率、退款异常率

### 3.3 性能
- 首页首屏渲染耗时（TTI/自定义指标）
- 列表页滑动/分页耗时（可采样）

---

## 4. 事件表（模板）
- `xfq-miniapp/doc/observability-events.csv`：事件定义与参数表模板

