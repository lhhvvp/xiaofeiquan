<view class="container">
  <view wx:if="{{!hasBaseUrl}}" class="notice">
    baseUrl 未配置：请创建 miniprogram/config/local.js 并设置 { baseUrl }
  </view>

  <scroll-view scroll-x class="tabs">
    <view
      wx:for="{{tabs}}"
      wx:key="title"
      class="tab {{index===currentIndex?'active':''}}"
      data-index="{{index}}"
      bindtap="onTapTab"
    >
      {{item.title}}
    </view>
  </scroll-view>

  <view wx:if="{{!hasLogin}}" class="notice">
    <view>查看订单需要先登录</view>
    <ui-button type="primary" size="mini" text="去登录" bind:tap="ensureLoginOrPrompt" />
  </view>

  <ui-empty wx:if="{{hasLogin && empty}}" text="暂无订单" />

  <view wx:for="{{list}}" wx:key="orderNo" class="item" data-index="{{index}}" bindtap="onTapDetail">
    <image class="img" src="{{item.icon}}" mode="aspectFill" />
    <view class="main">
      <view class="row">
        <view class="title">{{item.title}}</view>
        <view class="status {{item.statusClass}}">{{item.statusText}}</view>
      </view>
      <view class="sub">订单号：{{item.orderNo}}</view>
      <view class="sub">金额：￥{{item.price}}</view>
      <view class="actions">
        <ui-button
          wx:if="{{item.canPay}}"
          size="mini"
          type="primary"
          text="立即支付"
          loading="{{payingOrderNo===item.orderNo}}"
          disabled="{{payingOrderNo===item.orderNo}}"
          data-index="{{index}}"
          bind:tap="onTapPay"
        />
        <ui-button
          wx:if="{{item.canRefund}}"
          size="mini"
          text="退款"
          plain="{{true}}"
          data-index="{{index}}"
          bind:tap="onTapOpenRefund"
        />
      </view>
    </view>
  </view>

  <ui-list-footer
    wx:if="{{hasLogin && !empty}}"
    status="{{loadingStatus}}"
    bind:retry="onRetry"
  />

  <ui-error wx:if="{{error}}" message="{{error}}" bind:retry="onRetry" />

  <view wx:if="{{refundModal.show}}" class="mask" bindtap="onCloseRefund">
    <view class="refund" catchtap="noop">
      <view class="refund-head">
        <view class="refund-title">退款理由</view>
        <view class="refund-close" bindtap="onCloseRefund">关闭</view>
      </view>
      <textarea class="refund-text" placeholder="请输入退款理由" value="{{refundModal.remark}}" bindinput="onInputRefundRemark" />
      <ui-button
        type="primary"
        text="{{refundModal.submitting ? '提交中...' : '提交'}}"
        block="{{true}}"
        loading="{{refundModal.submitting}}"
        disabled="{{refundModal.submitting}}"
        bind:tap="onSubmitRefund"
      />
    </view>
  </view>
</view>
