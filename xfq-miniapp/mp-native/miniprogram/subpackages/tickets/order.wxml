<view class="container">
  <view wx:if="{{!hasBaseUrl}}" class="notice">
    baseUrl 未配置：请创建 miniprogram/config/local.js 并设置 { baseUrl }
  </view>

  <view class="card">
    <view class="card-title">门票下单</view>
    <view class="row">
      <view class="label">票ID</view>
      <view class="value">{{ticketId}}</view>
    </view>
    <view class="row">
      <view class="label">日期</view>
      <picker mode="selector" range="{{dateOptions}}" value="{{selectedIndex}}" bindchange="onPickDate">
        <view class="picker">{{selectedDate || '请选择日期'}}</view>
      </picker>
    </view>
    <view class="row">
      <view class="label">单价</view>
      <view class="value">￥{{unitPrice}}</view>
    </view>
    <view class="row">
      <view class="label">库存</view>
      <view class="value">{{stock}}</view>
    </view>
    <view class="row row-qty">
      <view class="label">数量</view>
      <view class="qty">
        <button size="mini" bindtap="onTapMinus" disabled="{{quantity <= 1}}">-</button>
        <input class="qty-input" type="number" value="{{quantity}}" bindinput="onInputQuantity" />
        <button size="mini" bindtap="onTapPlus" disabled="{{quantity >= maxQuantity}}">+</button>
      </view>
      <view class="qty-hint">最多 {{maxQuantity}} 张</view>
    </view>
  </view>

  <view class="card">
    <view class="card-title">游客信息</view>
    <view wx:if="{{selectedTourists.length}}" class="tourist-list">
      <view wx:for="{{selectedTourists}}" wx:key="id" class="tourist-item">
        <view class="tourist-name">{{item.fullname}}</view>
        <view class="tourist-sub">手机 {{item.mobile}}</view>
        <view class="tourist-sub">证件 {{item.cert_id}}</view>
      </view>
    </view>
    <view wx:else class="empty">未选择游客</view>
    <button bindtap="onTapChooseTourists">选择游客（需与数量一致）</button>
    <view wx:if="{{autoTouristHint}}" class="hint">{{autoTouristHint}}</view>
  </view>

  <view class="card">
    <view class="card-title">联系人信息</view>
    <view class="input-row">
      <view class="label">姓名</view>
      <input class="input" value="{{contactName}}" bindinput="onInputContactName" placeholder="请输入联系人姓名" />
    </view>
    <view class="input-row">
      <view class="label">手机号</view>
      <input class="input" value="{{contactPhone}}" bindinput="onInputContactPhone" placeholder="请输入手机号" />
    </view>
  </view>

  <view class="card">
    <view class="card-title">订单备注（选填）</view>
    <textarea class="textarea" value="{{orderRemark}}" bindinput="onInputRemark" placeholder="请输入备注"></textarea>
  </view>

  <view class="footer">
    <view class="total">合计：￥{{totalPrice}}</view>
    <button type="primary" loading="{{submitting}}" bindtap="onTapSubmit">提交并支付</button>
  </view>

  <view wx:if="{{payResultText}}" class="card">
    <view class="card-title">返回（调试）</view>
    <text selectable="true" class="json">{{payResultText}}</text>
    <button size="mini" bindtap="onTapCopyPayResult">复制返回</button>
  </view>

  <view wx:if="{{showTouristModal}}" class="modal-mask" bindtap="onTapCloseTouristModal">
    <view class="modal" catchtap="noop">
      <view class="modal-header">
        <view class="modal-title">选择游客（{{touristTempCount}}/{{quantity}}）</view>
        <view class="modal-close" bindtap="onTapCloseTouristModal">×</view>
      </view>
      <view class="modal-body">
        <checkbox-group bindchange="onTouristCheckboxChange">
          <view wx:for="{{touristList}}" wx:key="id" class="tourist-option">
            <checkbox value="{{item.id}}" checked="{{item.checked}}" disabled="{{item.disabled}}" />
            <view class="opt-main">
              <view class="opt-title">{{item.fullname}}</view>
              <view class="opt-sub">{{item.mobile}} | {{item.cert_id}}</view>
            </view>
          </view>
        </checkbox-group>
        <view wx:if="{{touristList.length == 0}}" class="empty">暂无游客数据</view>
      </view>
      <view class="modal-actions">
        <button bindtap="onTapCloseTouristModal">取消</button>
        <button type="primary" bindtap="onTapConfirmTourists">确定</button>
      </view>
    </view>
  </view>

  <view wx:if="{{error}}" class="error">error: {{error}}</view>
</view>
